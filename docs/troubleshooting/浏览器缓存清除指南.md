# 浏览器缓存清除指南

## 问题描述
代码已更新并部署到服务器，但浏览器仍然显示旧版本的JavaScript文件，导致功能异常。

## 根本原因
浏览器缓存了旧的JavaScript文件（`.js`），即使服务器已经更新了代码，浏览器仍然使用缓存的旧文件。

## 解决方案

### 方案1：强制刷新（最简单）⭐
在浏览器中按以下快捷键：

**Windows/Linux:**
- `Ctrl + Shift + R` 或
- `Ctrl + F5`

**Mac:**
- `Cmd + Shift + R`

这会绕过缓存，强制浏览器重新下载所有资源。

### 方案2：清除浏览器缓存
1. 按 `Ctrl + Shift + Delete`（Mac: `Cmd + Shift + Delete`）
2. 选择"缓存的图片和文件"
3. 时间范围选择"全部"
4. 点击"清除数据"
5. 刷新页面

### 方案3：使用无痕模式测试
1. 按 `Ctrl + Shift + N`（Mac: `Cmd + Shift + N`）打开无痕窗口
2. 访问 http://101.37.24.171:8081
3. 测试功能是否正常

无痕模式不使用缓存，可以验证是否是缓存问题。

### 方案4：开发者工具禁用缓存
1. 按 `F12` 打开开发者工具
2. 切换到 **Network（网络）** 标签
3. 勾选 **Disable cache（禁用缓存）**
4. 保持开发者工具打开状态
5. 刷新页面

## 验证修复
打开浏览器控制台（F12），应该看到：
```
[OnlyOffice] Editor config: {document: {...}, ...}
```

**不应该**看到：
```
[OnlyOffice] Editor config: undefined
```

## 技术说明

### 为什么会发生缓存问题？
之前的nginx配置对JS/CSS文件使用了1年强缓存：
```nginx
expires 1y;  # 浏览器会缓存1年
```

这导致浏览器认为文件在1年内都不会改变，不会向服务器请求新版本。

### 已修复的nginx配置
现在使用协商缓存：
```nginx
location ~* \.(js|css)$ {
    add_header Cache-Control "no-cache, must-revalidate";
    etag on;
}
```

这会让浏览器每次都向服务器验证文件是否更新，如果更新了就下载新版本。

### 为什么需要手动清除缓存？
因为旧的JS文件已经被浏览器缓存了1年，浏览器不会主动检查更新。只有清除缓存后，浏览器才会使用新的缓存策略。

## 后续预防
新的nginx配置已经部署，以后更新代码后：
1. 浏览器会自动检查文件是否更新
2. 如果更新了，会自动下载新版本
3. 不需要手动清除缓存

但对于已经缓存的旧文件，仍需要手动清除一次。
