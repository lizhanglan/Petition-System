    # 信访智能文书生成系统需求规格说明书（最终版）

# 文档说明

本文档基于信访局业务核心诉求，结合全量业务规则、技术实现细节确认信息编制，无待确认项。文档明确了信访智能文书生成系统的功能需求、技术规范、非功能性要求及扩展预留内容，可直接作为系统开发、测试、验收的核心依据，保障系统开发与业务需求高度匹配。

核心编制依据：《党政机关公文格式》《党政机关公文处理工作条例》《信访业务术语（2023年版）》、用户确认的业务规则及技术实现要求。

# 一、项目核心概述

## 1.1 产品定位

面向各级信访局工作人员的专属智能文书工具，核心聚焦信访/回访类文件的合规研判、AI智能生成、全链路修改留痕、文书模板自识别沉淀四大核心能力。系统深度对接DeepSeek大模型API完成文本智能分析与生成，模板结构化逻辑、格式渲染、数据校验均由本地/服务端独立处理，适配信访业务专属场景，所有用户账号数据完全独立隔离，无跨账号数据交互与编辑冲突。

## 1.2 核心依据规范

系统所有文书内容、格式的合规性校验，均严格遵循《党政机关公文格式》《党政机关公文处理工作条例》《信访业务术语（2023年版）》官方规则库，规则库支持模板化配置与复用，可适配后续规则更新需求。

## 1.3 核心技术前置约定

- 支持文件格式：仅PDF、Word（DOC/DOCX），预留OCR模型对接位置，供后续功能扩展，本次暂不开发；

- 核心富文本编辑器：采用ProseMirror，支持模板占位符编辑、版本差异可视化编辑，无需定制信访专属功能；

- 数据存储规范：业务数据（案件、文书、模板、版本、日志）存储于PostgreSQL；文件（上传文件、生成文件、模板文件）存储于MinIO，存储策略无额外要求；

- 网络要求：需连接外网调用DeepSeek API，外网API调用行为无需专项审计，仅记录系统级操作日志。

## 1.4 全局核心业务原则

- 账号独立性：所有用户账号数据独立，文件、模板、修改记录、生成内容均为账号私有，无跨账号数据交互；

- AI标注规则：以句号作为“一句话”的边界，按问题影响范围标注（错别字标字符、单句问题标整句、整段问题标整段）；标注颜色支持用户自定义，内容错误与格式错误颜色强制区分；

- 标注导出规则：标注后的文书下载时，是否保留AI标注意见/底色，由用户自主选择；

- 日志留存规则：所有操作日志、访问日志、版本记录永久留存，支持全量追溯；

- 模板编辑规则：无角色权限区分，所有账号均可编辑自有模板，无审核流程，无跨账号编辑冲突。

# 二、核心功能需求详述（按优先级排序）

## 2.1 文件研判模块（核心功能）

### 2.1.1 文件上传+云端预览+原格式还原

- 文件上传：支持单文件/多文件批量上传PDF、Word格式信访/回访文件，无大小限制；上传后自动解析元数据（文件名、上传时间、类型、大小）并关联账号存储；

- 文件预览：调用云服务API实现在线预览，1:1还原原文件格式（排版、表格、页眉页脚、文号等），无格式错乱；

- 扩展预留：文件解析模块预留OCR模型接入接口，后续可无缝扩展扫描件、图片类文件解析能力。

### 2.1.2 AI智能研判（DeepSeek API驱动，同步调用）

- 研判范围：基于官方规则库，完成内容合规性（错别字、术语合规、语义精准度、诉求完整性、法规真实性）与格式规范性（文号、排版、页眉页脚、落款）双重校验；

- 研判逻辑：AI自主分析问题，按“字符级-句子级-整段级”标注范围，严格遵循“句号为语句边界”规则，输出结构化错误信息。

### 2.1.3 智能错误标注+在线修正

- 错误标注：预览页按用户自定义颜色标注错误区域，内容与格式错误颜色区分；鼠标悬浮展示“问题描述+修正建议+合规依据”；

- 在线编辑：基于ProseMirror实现全量在线修正，支持文本编辑、格式调整、模板占位符编辑，无角色权限限制；

- 编辑特性：保留原文件合规格式，仅修改错误内容/格式，编辑后实时刷新预览效果。

### 2.1.4 API调用策略（强制落地）

- 调用模式：同步调用DeepSeek API完成AI研判；

- 重试机制：调用失败自动重试3次，指数退避等待（1000ms→2000ms→4000ms）；

- 限流+降级：内置限流机制防止API过载，连续失败/超时时切换为本地规则库兜底校验，保障基础研判能力。

## 2.2 文件生成模块（核心功能）

### 2.2.1 AI对话式需求输入+多轮迭代优化

- 交互形式：提供AI对话窗口，支持纯文本输入生成需求，可实时上传、引用案件信息/参考文件；

- 多轮对话规则：保留最近10轮对话上下文，支持基于历史对话迭代优化需求，实现文书渐进式完善；

- 输入容错：支持模糊需求输入，AI自动解析核心诉求，缺失信息时主动引导补充。

### 2.2.2 固定模板匹配+智能文书生成

- 模板基础：沿用12类信访核心标准化模板（受理通知书、转办函等），支持参数化配置（文号、成文日期、主送单位等）；

- 生成核心逻辑（强制规范）：
        

    - DeepSeek API仅处理纯文本交互，负责生成合规正文，不具备模板解析、格式渲染、占位符填充能力；

    - 模板版式、字段填充由本地/服务端业务层处理；

    - 生成流程：解析提示词提取字段→本地填充模板参数→AI优化正文→前端渲染完整格式文书。

- 合规校验增强：AI无边界联网校验提示词中法规/政策真实性，联网失败降级为本地RAG知识库校验；校验结果附来源链接+效力层级。

### 2.2.3 提示词错误反馈+预览编辑+文件下载

- 错误反馈：提示词存在信息缺失/错误时，对话末尾返回结构化错误提示，指明问题并引导补充；

- 文书预览：生成文书按模板规范展示，1:1还原公文样式，支持ProseMirror在线编辑、占位符调整，编辑后实时刷新；

- 文件下载：支持PDF、DOCX格式导出，用户可自主选择是否添加公文规范固定样式水印/密级标注、是否保留AI标注意见；暂不支持电子盖章，预留扩展位置。

## 2.3 修改痕迹与精细化回滚模块（全局复用）

生效范围：文件研判编辑、文件生成编辑，所有修改自动触发痕迹记录，仅对当前账号文件生效。

### 2.3.1 全维度修改痕迹记录

- 记录维度：自动记录修改时间、前后内容结构化对比、修改原因（用户可选填）；

- 存储方式：全量存储历史版本，无数量限制；

- 差异对比：提供专属对比视图，基于“模板结构化+字段ID”的结构化diff算法，仅对比可编辑区域内容，忽略固定格式，标注增删改内容，支持跨版本对比。

### 2.3.2 精细化版本回滚（账号自主操作）

- 回滚权限：账号仅能对自有文件/模板执行回滚，无角色限制；

- 回滚粒度：支持全版本回滚（恢复指定版本所有内容）、字段级回滚（仅回滚单个绑定字段内容）；

- 版本规则：回滚后不覆盖原版本，自动生成新记录并标注“回滚版本+原版本号+回滚原因”。

## 2.4 信访文书模板智能识别与管理模块

### 2.4.1 模板智能提取（自动+手动双模式）

- 触发条件：用户上传文件、研判修正后合规文件，默认自动授权提取，无需弹窗确认；

- 提取维度：自动提取核心固定信息（案件编号、主送单位、文号规则、文书类型、落款格式等）；

- 提取逻辑：本地解析文档格式/内容→调用DeepSeek API结构化提取→JSON格式存储；

- 双提取模式：支持系统自动提取、用户手动提取，用户可自主调整提取字段、模板结构；

- 确认机制：提取完成后展示模板预览+字段清单，用户确认无误后完成模板创建。

### 2.4.2 模板库管理+精准检索

- 模板入库：确认后的模板纳入账号专属标准模板库，支持版本管理、分类归档、启用/停用，无审核流程；

- 检索能力：支持文书类型检索、结构特征检索、全文检索（模板标题、占位符、关键字段模糊检索）；

- 模板独立性：账号私有模板，无跨账号共享，无编辑冲突。

# 三、通用基础功能（全模块支撑，必做）

## 3.1 账号独立机制

所有用户账号数据完全隔离，文件、模板、版本记录、生成内容、操作日志均为账号私有，无任何跨账号数据交互；无角色权限分级，所有账号功能操作权限一致。

## 3.2 操作审计与日志管理

- 日志记录范围：覆盖文件上传、研判、AI生成、编辑、回滚、模板提取、下载等全操作链路；

- 存储规则：操作日志、访问日志永久留存，支持按操作时间、类型、文件名称精准检索；

- 审计豁免：外网API调用网络行为无需专项审计，仅记录API调用成功/失败状态。

## 3.3 密级管理

支持文书密级标注，密级样式严格遵循党政机关公文规范固定样式，无需用户自定义；仅做标注展示，无额外密级访问限制规则。

## 3.4 数据一致性保障

前端仅负责展示+编辑，后端掌控格式+数据，编辑操作实时同步至后端；版本回滚后，关联文件内容、模板字段、修改记录同步更新，无数据断层。

# 四、核心技术实现规范（强制落地）

## 4.1 DeepSeek API 对接规范

- 调用模式：全量同步调用，AI研判、文本生成、结构化提取均同步执行；

- 重试策略：失败自动重试3次，指数退避等待（1000ms→2000ms→4000ms）；

- 限流机制：内置API调用限流，防止密集调用触发服务商限流；

- 降级策略：API连续失败/超时时，切换为本地规则库兜底校验；

- 能力边界：仅处理纯文本交互，模板结构化逻辑由本地/服务端处理。

## 4.2 前端核心技术组件

- 富文本编辑器：ProseMirror，支持模板占位符编辑、版本差异可视化编辑；

- 文件预览：云服务API+PDF.js、Docx-preview组件，保障格式1:1还原；

- 差异对比：基于diff-match-patch算法适配结构化字段ID，实现精准字段级对比。

## 4.3 后端核心技术逻辑

- 模板处理：模板结构化配置，字段与模板绑定唯一ID，支持参数化填充、字段级编辑；

- AI生成逻辑：提示词解析→关键字段提取→本地模板填充→AI优化正文→前端渲染；

- 结构化diff算法：基于模板字段ID对比，仅对比可编辑区域，忽略固定格式内容。

## 4.4 存储规范

业务数据（案件、文书、模板、版本、日志）存储于PostgreSQL，无分库分表要求；文件存储于MinIO，无分片、备份、生命周期要求；可选Redis缓存模板配置、用户标注颜色、对话上下文，提升响应速度。

# 五、非功能性需求

## 5.1 性能需求

- 文件研判：单文件（≤50MB）研判响应≤30s，预览加载≤5s；

- 文书生成：需求输入后生成初稿≤20s；

- 并发支持：≥200个账号同时在线操作无卡顿；

- 版本回滚：字段级回滚≤2s，全版本回滚≤5s。

## 5.2 可用性需求

- 系统可用性：月均≥99.5%，故障恢复≤10min；

- 操作友好性：可视化交互，学习成本低；

- 容错性：支持文件续传、编辑自动保存、API重试，无数据丢失风险。

## 5.3 兼容性需求

- 浏览器兼容：支持Chrome、Edge、Firefox及政务内网常用浏览器；

- 文件兼容：支持主流PDF、Word版本（DOC、DOCX 2007-2021）。

# 六、功能扩展预留（无开发成本）

- OCR模型对接：文件上传模块预留标准化接口，后续可接入OCR识别能力；

- 电子盖章功能：文件下载模块预留电子印章对接接口；

- 多部门模板共享：模板库预留跨账号共享开关，后续可开放共享、审核机制；

- 批量生成文书：文件生成模块预留批量导入、批量生成能力。

# 七、开发注意事项

- 严格遵循“前端展示编辑、后端掌控数据格式”的分工原则，保障数据一致性；

- API调用策略需严格落地重试、限流、降级机制，避免服务中断；

- 账号数据隔离需贯穿全系统，确保无跨账号数据泄露、交互；

- 所有修改痕迹、日志需永久留存，不可删除或篡改；

- 预留扩展功能接口需标准化，保障后续无缝对接。

# 文档完结说明

本文档为最终定稿版本，包含系统全部业务需求、技术细节、核心规则及开发要求，无待确认项，可直接作为开发、测试、验收的唯一核心依据。
> （注：文档部分内容可能由 AI 生成）