# 🚀 开始测试ONLYOFFICE集成

## ✅ 当前状态

### 已完成
- ✅ 后端服务已启动: http://localhost:8000
- ✅ 前端服务已启动: http://localhost:5173
- ✅ ONLYOFFICE配置已完成
- ✅ 后端代理机制已实现
- ✅ 健康检查通过

### 配置信息
- **后端公网地址**: http://101.37.24.171:8000
- **ONLYOFFICE服务器**: http://101.37.24.171:9090
- **MinIO存储**: 124.70.74.202:9000

---

## 📋 测试步骤

### 步骤1: 注册/登录用户（5分钟）

1. **打开前端**:
   - 浏览器访问: http://localhost:5173
   
2. **注册新用户**:
   - 点击"注册"
   - 填写用户信息
   - 提交注册

3. **登录**:
   - 使用注册的用户名和密码登录
   - 登录成功后进入系统

### 步骤2: 上传测试文件（5分钟）

1. **进入文件管理页面**:
   - 点击左侧菜单"文件管理"

2. **上传DOCX文件**:
   - 点击"上传文件"按钮
   - 选择一个DOCX文件（建议小于10MB）
   - 等待上传完成

3. **记录文件信息**:
   - 记下上传的文件ID（在文件列表中显示）

### 步骤3: 使用测试页面验证（10分钟）

1. **打开测试页面**:
   - 双击打开: `test_onlyoffice_with_backend.html`
   - 或在浏览器中打开该文件

2. **配置后端地址**:
   - 在"配置后端地址"输入框中输入: `http://101.37.24.171:8000`
   - 注意：必须使用公网IP，不能使用localhost

3. **测试后端连接**:
   - 点击"1. 测试后端连接"按钮
   - 等待响应，应该显示"✅ 后端连接成功"

4. **测试代理端点**:
   - 点击"2. 测试代理端点"按钮
   - 如果有文件，应该显示"✅ 代理端点测试成功"
   - 如果显示404，说明文件ID=1不存在，这是正常的

5. **测试预览模式**:
   - 点击"3. 预览模式"按钮
   - 等待ONLYOFFICE编辑器加载
   - 应该看到文档内容（如果文件存在）

6. **测试编辑模式**:
   - 点击"4. 编辑模式"按钮
   - 等待ONLYOFFICE编辑器加载
   - 尝试编辑文档内容
   - 保存文档

### 步骤4: 在前端测试（待实现）

**注意**: 前端页面集成尚未完成，需要更新以下文件：
- `frontend/src/views/Files.vue` - 文件预览
- `frontend/src/views/Generate.vue` - 文书生成预览
- `frontend/src/views/Documents.vue` - 文书管理

---

## 🔍 验证要点

### 1. 后端健康检查
```powershell
# 在PowerShell中执行
Invoke-RestMethod -Uri http://localhost:8000/api/v1/onlyoffice/health -Method Get
```

**预期结果**:
```json
{
    "status": "ok",
    "onlyoffice_enabled": false,
    "server_url": "http://101.37.24.171:9090",
    "backend_public_url": "http://101.37.24.171:8000"
}
```

### 2. ONLYOFFICE服务检查
在浏览器中访问: http://101.37.24.171:9090/healthcheck

**预期结果**: 显示 `true`

### 3. 代理端点检查
在浏览器中访问: http://101.37.24.171:8000/api/v1/onlyoffice/download/file/1

**预期结果**: 
- 如果文件存在：下载文件
- 如果文件不存在：显示404错误

---

## ⚠️ 常见问题

### 问题1: 编辑器显示"下载失败"（错误代码-4）

**原因**: ONLYOFFICE无法访问后端代理URL

**解决方案**:
1. 确认后端地址使用公网IP: `http://101.37.24.171:8000`
2. 检查防火墙是否允许ONLYOFFICE（101.37.24.171）访问后端端口8000
3. 在ONLYOFFICE服务器上测试:
   ```bash
   curl http://101.37.24.171:8000/api/v1/onlyoffice/health
   ```

### 问题2: 测试页面无法连接后端

**原因**: 后端地址配置错误或服务未启动

**解决方案**:
1. 确认后端服务正在运行
2. 检查后端地址是否正确
3. 尝试在浏览器中直接访问: http://101.37.24.171:8000/api/v1/onlyoffice/health

### 问题3: 文件上传失败

**原因**: MinIO连接问题或权限问题

**解决方案**:
1. 检查MinIO服务是否正常运行（124.70.74.202:9000）
2. 检查MinIO配置是否正确
3. 查看后端日志

---

## 📊 测试检查清单

### 基础测试
- [x] 后端服务启动
- [x] 前端服务启动
- [x] 健康检查通过
- [ ] 用户注册成功
- [ ] 用户登录成功
- [ ] 文件上传成功

### ONLYOFFICE测试
- [ ] 测试页面打开成功
- [ ] 后端连接测试通过
- [ ] 代理端点测试通过
- [ ] 预览模式加载成功
- [ ] 编辑模式加载成功
- [ ] 文档编辑成功
- [ ] 文档保存成功

### 前端集成测试（待完成）
- [ ] Files.vue预览功能
- [ ] Generate.vue预览功能
- [ ] Documents.vue编辑功能

---

## 📝 测试记录

### 测试环境
- 操作系统: Windows
- 浏览器: [填写]
- 后端版本: [填写]
- 前端版本: [填写]

### 测试结果
| 测试项 | 状态 | 备注 |
|--------|------|------|
| 后端启动 | ✅ | |
| 前端启动 | ✅ | |
| 健康检查 | ✅ | |
| 用户注册 | ⏳ | |
| 文件上传 | ⏳ | |
| 预览模式 | ⏳ | |
| 编辑模式 | ⏳ | |
| 文档保存 | ⏳ | |

### 问题记录
| 问题描述 | 严重程度 | 状态 | 解决方案 |
|----------|----------|------|----------|
| | | | |

---

## 🎯 下一步

### 立即行动
1. ✅ 启动服务 - 已完成
2. ⏳ 注册用户 - 进行中
3. ⏳ 上传文件 - 待开始
4. ⏳ 测试ONLYOFFICE - 待开始

### 短期任务
1. 完成功能测试
2. 验证所有功能正常
3. 记录测试结果
4. 前端页面集成

### 长期任务
1. 版本管理集成
2. 协作编辑功能
3. 性能优化
4. 生产环境部署

---

## 📚 相关文档

- [ONLYOFFICE测试报告](ONLYOFFICE测试报告.md)
- [ONLYOFFICE集成完成总结](ONLYOFFICE集成完成总结.md)
- [ONLYOFFICE快速参考卡](ONLYOFFICE快速参考卡.md)
- [ONLYOFFICE部署配置指南](docs/deployment/ONLYOFFICE部署配置指南.md)

---

## 💡 提示

1. **使用公网IP**: 测试页面中必须使用 `http://101.37.24.171:8000`，不能使用localhost
2. **检查防火墙**: 确保ONLYOFFICE能访问后端端口8000
3. **查看日志**: 如果遇到问题，查看后端日志获取详细信息
4. **文件大小**: 建议使用小于10MB的文件进行测试

---

**开始测试**: 2026-01-03  
**测试人员**: [填写]  
**预计时间**: 30分钟
