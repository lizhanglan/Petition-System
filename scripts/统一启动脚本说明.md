# 统一启动脚本说明

**创建日期**: 2026-01-04  
**版本**: 1.0

---

## 概述

为简化项目的启动和管理，创建了统一的启动脚本，整合了本地开发和Docker部署两种模式。

---

## 脚本文件

### Windows
- **run.bat** - Windows统一启动脚本

### Linux/Mac
- **run.sh** - Linux/Mac统一启动脚本

---

## 功能特性

### 1. 交互式菜单
- 友好的图形化菜单界面
- 支持键盘选择操作
- 自动检测环境和依赖

### 2. 双模式支持
- **本地开发模式**: 直接运行Python和Node.js
- **Docker部署模式**: 使用Docker Compose

### 3. 完整功能
- 启动/停止/重启服务
- 查看服务状态
- 初始化数据库
- 备份数据
- 清理数据
- 查看日志

---

## 使用方法

### Windows

#### 交互式菜单（推荐）
```cmd
run.bat
```

然后根据菜单选择操作：
```
========================================
信访智能文书生成系统
========================================

请选择运行模式:

[1] 本地开发模式 (直接运行)
[2] Docker 部署模式
[3] 查看服务状态
[4] 初始化数据库
[5] 备份数据
[6] 清理数据
[0] 退出

========================================
请输入选项 (0-6):
```

### Linux/Mac

#### 交互式菜单（推荐）
```bash
chmod +x run.sh
./run.sh
```

#### 命令行模式
```bash
# 本地开发模式
./run.sh dev

# Docker 部署模式
./run.sh docker

# 停止服务
./run.sh stop

# 重启服务
./run.sh restart

# 查看日志
./run.sh logs

# 查看状态
./run.sh status

# 初始化数据库
./run.sh init

# 备份数据
./run.sh backup

# 清理数据
./run.sh clean
```

---

## 模式说明

### 本地开发模式

**适用场景**：
- 本地开发和调试
- 快速测试功能
- 代码热更新

**要求**：
- Python 3.12+
- Node.js 18+
- PostgreSQL 14+
- Redis 6+
- MinIO

**启动流程**：
1. 检查Python和Node.js
2. 创建虚拟环境（如果不存在）
3. 安装依赖（如果不存在）
4. 启动后端服务（端口8000）
5. 启动前端服务（端口5173）

**访问地址**：
- 前端：http://localhost:5173
- 后端：http://localhost:8000
- API文档：http://localhost:8000/docs

### Docker 部署模式

**适用场景**：
- 生产环境部署
- 测试环境部署
- 快速部署和迁移

**要求**：
- Docker
- Docker Compose

**启动流程**：
1. 检查Docker和Docker Compose
2. 检查.env配置文件
3. 启动所有容器
4. 等待服务就绪
5. 显示访问地址

**访问地址**：
- 前端：http://localhost
- 后端：http://localhost:8000
- MinIO控制台：http://localhost:9001

---

## 功能详解

### 1. 本地开发模式

**自动化功能**：
- ✅ 自动检测Python和Node.js
- ✅ 自动创建虚拟环境
- ✅ 自动安装依赖
- ✅ 自动复制.env配置
- ✅ 同时启动前后端

**优点**：
- 代码热更新
- 调试方便
- 启动快速

**缺点**：
- 需要手动安装依赖服务
- 环境配置复杂

### 2. Docker 部署模式

**子菜单**：
```
[1] 启动服务
[2] 停止服务
[3] 重启服务
[4] 查看日志
[0] 返回主菜单
```

**优点**：
- 一键部署
- 环境隔离
- 易于迁移

**缺点**：
- 首次构建较慢
- 资源占用较多

### 3. 查看服务状态

**检查内容**：
- Docker服务状态
- 后端服务健康检查
- 前端服务可访问性

**输出示例**：
```
[Docker 服务]
NAME                STATUS    PORTS
petition-backend    Up        0.0.0.0:8000->8000/tcp
petition-frontend   Up        0.0.0.0:80->80/tcp

[本地服务]
√ 后端服务正常 (http://localhost:8000)
√ 前端服务正常 (http://localhost:5173)
```

### 4. 初始化数据库

**功能**：
- 创建数据库表结构
- 初始化标准模板
- 自动检测运行模式（Docker/本地）

**使用时机**：
- 首次部署
- 数据库重置后
- 表结构更新后

### 5. 备份数据

**备份内容**：
- PostgreSQL数据库

**备份位置**：
```
backups/
└── YYYYMMDD_HHMMSS/
    └── database.sql
```

**使用建议**：
- 定期备份（每天/每周）
- 重大更新前备份
- 保留多个备份版本

### 6. 清理数据

**清理内容**：
- 删除所有Docker容器
- 删除所有Docker卷
- 清空数据库
- 清空Redis
- 清空MinIO

**警告**：
- ⚠️ 此操作不可逆
- ⚠️ 会删除所有数据
- ⚠️ 需要确认（输入yes）

---

## 与旧脚本对比

### 旧脚本（3个）

**start.bat**：
- 仅支持本地开发
- 功能单一

**deploy.bat**：
- 仅支持Docker部署
- 命令行参数

**deploy.sh**：
- 仅支持Docker部署
- 命令行参数

### 新脚本（2个）

**run.bat / run.sh**：
- ✅ 支持本地开发和Docker部署
- ✅ 交互式菜单
- ✅ 命令行参数（Linux/Mac）
- ✅ 完整的管理功能
- ✅ 自动环境检测
- ✅ 友好的用户界面

---

## 迁移建议

### 保留旧脚本
- start.bat - 快速启动本地开发
- deploy.bat - 快速Docker部署
- deploy.sh - 快速Docker部署

### 推荐使用新脚本
- run.bat / run.sh - 统一入口，功能完整

### 迁移步骤
1. 使用新脚本测试所有功能
2. 确认无问题后，可以归档旧脚本
3. 更新文档引用新脚本

---

## 故障排查

### 问题1: Python未找到
**解决方案**：
- 安装Python 3.12+
- 确保Python在PATH中
- Windows: 使用`python`命令
- Linux/Mac: 使用`python3`命令

### 问题2: Node.js未找到
**解决方案**：
- 安装Node.js 18+
- 确保Node.js在PATH中

### 问题3: Docker未找到
**解决方案**：
- 安装Docker Desktop（Windows/Mac）
- 安装Docker Engine（Linux）
- 启动Docker服务

### 问题4: 端口被占用
**解决方案**：
- 检查端口占用：`netstat -ano | findstr :8000`
- 停止占用端口的进程
- 或修改.env中的端口配置

### 问题5: 依赖安装失败
**解决方案**：
- 检查网络连接
- 使用国内镜像源
- 手动安装依赖

---

## 最佳实践

### 开发环境
1. 使用本地开发模式
2. 配置代码编辑器
3. 启用热更新
4. 定期备份数据

### 测试环境
1. 使用Docker部署模式
2. 模拟生产环境
3. 完整功能测试
4. 性能测试

### 生产环境
1. 使用Docker部署模式
2. 配置环境变量
3. 定期备份数据
4. 监控服务状态

---

## 后续改进

### 计划功能
- [ ] 支持多环境配置切换
- [ ] 自动更新检查
- [ ] 性能监控集成
- [ ] 日志分析工具
- [ ] 一键回滚功能

### 欢迎反馈
如有问题或建议，请提交Issue或Pull Request。

---

**维护者**: Kiro AI Assistant  
**最后更新**: 2026-01-04  
**文档版本**: 1.0
