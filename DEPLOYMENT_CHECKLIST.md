# 📋 Docker 部署检查清单

## 部署前检查

### 系统环境
- [ ] Docker 已安装（版本 20.10+）
- [ ] Docker Compose 已安装（版本 2.0+）
- [ ] 系统内存至少 4GB
- [ ] 磁盘空间至少 20GB
- [ ] 端口 80, 8000, 5432, 6379, 9000, 9001 未被占用

### 配置文件
- [ ] 已复制 `.env.example` 到 `.env`
- [ ] 已配置 `DEEPSEEK_API_KEY`（必填）
- [ ] 已修改 `SECRET_KEY`（建议至少 32 字符）
- [ ] 已修改数据库密码 `POSTGRES_PASSWORD`
- [ ] 已修改 Redis 密码 `REDIS_PASSWORD`
- [ ] 已修改 MinIO 密码 `MINIO_ROOT_PASSWORD`

### 文件准备
- [ ] 所有 Dockerfile 文件已创建
- [ ] docker-compose.yml 已创建
- [ ] nginx.conf 已创建
- [ ] .dockerignore 文件已创建

---

## 部署步骤

### 1. 启动服务
```bash
# Linux/Mac
chmod +x deploy.sh
./deploy.sh start

# Windows
deploy.bat start
```
- [ ] 所有容器成功启动
- [ ] 无错误日志

### 2. 初始化数据库
```bash
# Linux/Mac
./deploy.sh init

# Windows
deploy.bat init
```
- [ ] 数据库表创建成功
- [ ] 标准模板初始化成功

### 3. 验证服务
```bash
# Linux/Mac
./deploy.sh status

# Windows
deploy.bat status
```
- [ ] 前端服务正常（http://localhost）
- [ ] 后端服务正常（http://localhost:8000）
- [ ] API 文档可访问（http://localhost:8000/docs）
- [ ] MinIO 控制台可访问（http://localhost:9001）

---

## 功能测试

### 基础功能
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 文件上传功能正常
- [ ] 文件解析功能正常
- [ ] AI 研判功能正常（需要 DEEPSEEK_API_KEY）
- [ ] 文书生成功能正常
- [ ] 文档导出功能正常

### 高级功能
- [ ] 版本管理功能正常
- [ ] 版本对比功能正常
- [ ] 审计日志功能正常
- [ ] 模板管理功能正常
- [ ] 规则管理功能正常
- [ ] 健康监控功能正常

### 性能测试
- [ ] 页面加载速度正常（< 3秒）
- [ ] API 响应速度正常（< 1秒）
- [ ] 文件上传速度正常
- [ ] 并发访问正常（10+ 用户）

---

## 安全检查

### 密码安全
- [ ] 已修改所有默认密码
- [ ] 密码强度符合要求（至少 8 位，包含大小写字母和数字）
- [ ] JWT 密钥足够复杂（至少 32 字符）

### 网络安全
- [ ] 生产环境使用 HTTPS
- [ ] 数据库端口未对外暴露
- [ ] Redis 端口未对外暴露
- [ ] MinIO 端口仅必要时对外暴露

### 数据安全
- [ ] 已配置数据备份策略
- [ ] 已测试数据恢复流程
- [ ] 敏感数据已加密存储

---

## 监控和维护

### 日志管理
- [ ] 日志正常输出
- [ ] 日志轮转配置正确
- [ ] 错误日志及时告警

### 性能监控
- [ ] CPU 使用率正常（< 80%）
- [ ] 内存使用率正常（< 80%）
- [ ] 磁盘使用率正常（< 80%）
- [ ] 网络带宽充足

### 备份策略
- [ ] 已配置自动备份
- [ ] 备份文件可正常恢复
- [ ] 备份文件异地存储

---

## 生产环境额外检查

### 高可用性
- [ ] 配置负载均衡
- [ ] 配置服务自动重启
- [ ] 配置健康检查
- [ ] 配置故障转移

### 扩展性
- [ ] 支持水平扩展
- [ ] 数据库连接池配置合理
- [ ] 缓存策略配置合理

### 合规性
- [ ] 符合数据保护法规
- [ ] 符合安全审计要求
- [ ] 符合行业标准

---

## 部署后验证

### 立即验证（部署后 1 小时内）
- [ ] 所有服务正常运行
- [ ] 核心功能可用
- [ ] 无严重错误日志
- [ ] 性能指标正常

### 短期验证（部署后 24 小时内）
- [ ] 系统稳定运行
- [ ] 无内存泄漏
- [ ] 无性能下降
- [ ] 用户反馈正常

### 长期验证（部署后 1 周内）
- [ ] 系统持续稳定
- [ ] 备份恢复测试通过
- [ ] 监控告警正常
- [ ] 用户满意度达标

---

## 回滚计划

### 回滚准备
- [ ] 保留旧版本镜像
- [ ] 保留数据库备份
- [ ] 准备回滚脚本
- [ ] 通知相关人员

### 回滚步骤
```bash
# 1. 停止当前服务
./deploy.sh stop

# 2. 恢复数据库
docker-compose exec -T postgres psql -U postgres petition_system < backup.sql

# 3. 切换到旧版本
git checkout <old-version>

# 4. 重新启动
./deploy.sh start
```

---

## 问题记录

### 部署过程中遇到的问题
| 时间 | 问题描述 | 解决方案 | 负责人 |
|-----|---------|---------|--------|
|     |         |         |        |

### 待解决问题
| 优先级 | 问题描述 | 计划解决时间 | 负责人 |
|-------|---------|------------|--------|
|       |         |            |        |

---

## 签字确认

### 部署团队
- 部署工程师: ________________  日期: ________
- 测试工程师: ________________  日期: ________
- 运维工程师: ________________  日期: ________

### 验收团队
- 项目经理: ________________  日期: ________
- 技术负责人: ________________  日期: ________
- 客户代表: ________________  日期: ________

---

**检查清单版本**: 1.0  
**最后更新**: 2026-01-03  
**维护者**: Kiro AI Assistant
